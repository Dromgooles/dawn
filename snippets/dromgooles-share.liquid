{% comment %}
  Dromgoole's Custom Share Button

  A fully customizable share button with control over styling and icon.
  Uses native navigator.share() when available, with copy-to-clipboard fallback.

  Accepts:
  - block: {Object} Block with settings for label, icon, text_size, text_color, etc.
  - share_link: {String} URL to share
  - section_id: {String} Section ID for unique element IDs

  Usage:
  {% render 'dromgooles-share', block: block, share_link: share_url, section_id: section.id %}
{% endcomment %}

{%- liquid
  assign share_label = block.settings.share_label | default: 'Share'
  assign unique_id = section_id | append: '-' | append: block.id
  assign text_size = block.settings.text_size | default: 14
  assign icon_size = block.settings.icon_size | default: 16
  assign text_color = block.settings.text_color
  assign text_uppercase = block.settings.text_uppercase
  assign hide_icon = block.settings.hide_icon
-%}

{%- capture custom_styles -%}
  --dromgooles-share-text-size: {{ text_size }}px;
  --dromgooles-share-icon-size: {{ icon_size }}px;
  {%- if text_color != blank -%}
    --dromgooles-share-text-color: {{ text_color }};
  {%- endif -%}
  {%- if text_uppercase -%}
    --dromgooles-share-text-transform: uppercase;
    --dromgooles-share-letter-spacing: 0.1em;
  {%- endif -%}
{%- endcapture -%}

<div
  class="dromgooles-share"
  id="DromgoolesShare-{{ unique_id }}"
  style="{{ custom_styles | strip_newlines }}"
  {{ block.shopify_attributes }}
>
  {%- comment -%} Native share button (shown when navigator.share is available) {%- endcomment -%}
  <button
    type="button"
    class="dromgooles-share__button dromgooles-share__native hidden"
    aria-label="{{ share_label }}"
    data-share-url="{{ share_link }}"
    data-share-title="{{ product.title | default: page_title | escape }}"
  >
    {%- unless hide_icon -%}
      <span class="dromgooles-share__icon">
        {%- if block.settings.custom_icon != blank -%}
          <img
            src="{{ block.settings.custom_icon | image_url: width: 64 }}"
            alt=""
            width="{{ icon_size }}"
            height="{{ icon_size }}"
            loading="lazy"
          >
        {%- else -%}
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 13 12" aria-hidden="true">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M1.625 8.125v2.167a1.083 1.083 0 0 0 1.083 1.083h7.584a1.083 1.083 0 0 0 1.083-1.083V8.125"/>
            <path fill="currentColor" fill-rule="evenodd" d="M6.148 1.271a.5.5 0 0 1 .707 0L9.563 3.98a.5.5 0 0 1-.707.707L6.501 2.332 4.147 4.687a.5.5 0 1 1-.708-.707z" clip-rule="evenodd"/>
            <path fill="currentColor" fill-rule="evenodd" d="M6.5 1.125a.5.5 0 0 1 .5.5v6.5a.5.5 0 0 1-1 0v-6.5a.5.5 0 0 1 .5-.5" clip-rule="evenodd"/>
          </svg>
        {%- endif -%}
      </span>
    {%- endunless -%}
    <span class="dromgooles-share__label">{{ share_label }}</span>
  </button>

  {%- comment -%} Fallback: Details/Summary with copy-to-clipboard {%- endcomment -%}
  <details class="dromgooles-share__details" id="ShareDetails-{{ unique_id }}">
    <summary class="dromgooles-share__button">
      {%- unless hide_icon -%}
        <span class="dromgooles-share__icon">
          {%- if block.settings.custom_icon != blank -%}
            <img
              src="{{ block.settings.custom_icon | image_url: width: 64 }}"
              alt=""
              width="{{ icon_size }}"
              height="{{ icon_size }}"
              loading="lazy"
            >
          {%- else -%}
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 13 12" aria-hidden="true">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M1.625 8.125v2.167a1.083 1.083 0 0 0 1.083 1.083h7.584a1.083 1.083 0 0 0 1.083-1.083V8.125"/>
              <path fill="currentColor" fill-rule="evenodd" d="M6.148 1.271a.5.5 0 0 1 .707 0L9.563 3.98a.5.5 0 0 1-.707.707L6.501 2.332 4.147 4.687a.5.5 0 1 1-.708-.707z" clip-rule="evenodd"/>
              <path fill="currentColor" fill-rule="evenodd" d="M6.5 1.125a.5.5 0 0 1 .5.5v6.5a.5.5 0 0 1-1 0v-6.5a.5.5 0 0 1 .5-.5" clip-rule="evenodd"/>
            </svg>
          {%- endif -%}
        </span>
      {%- endunless -%}
      <span class="dromgooles-share__label">{{ share_label }}</span>
    </summary>
    <div class="dromgooles-share__dropdown">
      <div class="dromgooles-share__field">
        <label class="dromgooles-share__field-label visually-hidden" for="ShareUrl-{{ unique_id }}">
          {{ 'general.share.share_url' | t }}
        </label>
        <input
          type="text"
          class="dromgooles-share__input"
          id="ShareUrl-{{ unique_id }}"
          value="{{ share_link }}"
          readonly
          onclick="this.select();"
        >
        <button
          type="button"
          class="dromgooles-share__copy"
          aria-label="{{ 'general.share.copy_to_clipboard' | t }}"
          data-copy-target="ShareUrl-{{ unique_id }}"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M11 2H2v9" stroke="currentColor" stroke-width="1.25"/>
            <rect x="5" y="5" width="9" height="9" stroke="currentColor" stroke-width="1.25"/>
          </svg>
        </button>
      </div>
      <span class="dromgooles-share__message hidden" role="status" aria-live="polite">
        {{ 'general.share.success_message' | t }}
      </span>
    </div>
  </details>
</div>

<script src="{{ 'dromgooles-share.js' | asset_url }}" defer="defer"></script>
