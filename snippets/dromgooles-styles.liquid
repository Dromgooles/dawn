{% comment %}
  Dromgoole's Custom Styles Loader

  This snippet loads Dromgoole's custom CSS overrides after Dawn's base styles.

  INSTALLATION:
  Add ONE line to layout/theme.liquid after the base.css stylesheet tag (around line 259):

    {{ 'base.css' | asset_url | stylesheet_tag }}
    {% render 'dromgooles-styles' %}  <!-- ADD THIS LINE -->

  This is the ONLY modification needed to theme.liquid.
  All custom styles are contained in assets/dromgooles.css

  Author: Dromgoole's
  Created: 2024
  Dawn Version: 15.4.1
{% endcomment %}

{%- comment -%}
  Load custom CSS using deferred loading pattern for performance.
  Styles load as "print" media then switch to "all" after page load.
{%- endcomment -%}
<link rel="stylesheet" href="{{ 'dromgooles.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'dromgooles-brands-index.css' | asset_url }}" media="print" onload="this.media='all'">

{%- comment -%}
  Load custom JavaScript enhancements.
  Uses defer to avoid blocking render.
{%- endcomment -%}
<script src="{{ 'dromgooles-brands-index.js' | asset_url }}" defer="defer"></script>

{%- comment -%}
  Gift card recipient auto-check:
  Automatically checks "I want to send this as a gift" on gift card product pages.
  Waits for recipient-form custom element to initialize before checking.
{%- endcomment -%}
{%- if product.gift_card? -%}
  <script>
    (function () {
      'use strict';

      function autoCheckRecipient() {
        const recipientForm = document.querySelector('recipient-form');
        if (!recipientForm) return;

        const checkbox = recipientForm.querySelector('input[type="checkbox"]');
        if (!checkbox) return;

        // Wait for the checkbox to be enabled (done by recipient-form.js)
        if (checkbox.disabled) {
          requestAnimationFrame(autoCheckRecipient);
          return;
        }

        // Only check if not already checked
        if (!checkbox.checked) {
          checkbox.checked = true;
          // Dispatch change event to trigger recipient-form's showRecipientForm()
          checkbox.dispatchEvent(new Event('change', { bubbles: true }));
        }
      }

      // Start checking once DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', autoCheckRecipient);
      } else {
        autoCheckRecipient();
      }
    })();
  </script>
{%- endif -%}

{%- comment -%}
  Fallback for browsers with JavaScript disabled.
{%- endcomment -%}
<noscript>
  <link rel="stylesheet" href="{{ 'dromgooles.css' | asset_url }}">
</noscript>
